<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <TargetFrameworks>netstandard2.0;netstandard2.1;netcoreapp3.1;net5.0;net6.0;net6.0-android;net6.0-ios;net6.0-maccatalyst</TargetFrameworks>
        <LangVersion>8</LangVersion>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
        <Nullable>enable</Nullable>
        <DisableImplicitNamespaceImports>true</DisableImplicitNamespaceImports>
    </PropertyGroup>
    
    <ItemGroup>
        <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
            <_Parameter1>Silk.NET.Input.Sdl, PublicKey=00240000048000009400000006020000002400005253413100040000010001003978b9c8ce5c08d54ff797be6fdcb734bb8f8fd47082de8d4311a2b85f89e9d27720824c2ca9b19bd6bdf54c583d297cf346d204b2d70826627789e6f536a7aa4f3e40f37f92ebeef91b820f1a61f15e9c0dccf3c2d372b5b4fa0c630f7cb6f18ea6aca8d04a4104d762f36f9b57ecbdde1055a16f5f088262b2df54c128debf</_Parameter1>
        </AssemblyAttribute>
        <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
            <_Parameter1>Silk.NET.Windowing.Sdl.Android, PublicKey=00240000048000009400000006020000002400005253413100040000010001003978b9c8ce5c08d54ff797be6fdcb734bb8f8fd47082de8d4311a2b85f89e9d27720824c2ca9b19bd6bdf54c583d297cf346d204b2d70826627789e6f536a7aa4f3e40f37f92ebeef91b820f1a61f15e9c0dccf3c2d372b5b4fa0c630f7cb6f18ea6aca8d04a4104d762f36f9b57ecbdde1055a16f5f088262b2df54c128debf</_Parameter1>
        </AssemblyAttribute>
    </ItemGroup>

    <ItemGroup>
      <ProjectReference Include="..\Silk.NET.SDL\Silk.NET.SDL.csproj" />
      <ProjectReference Include="..\Silk.NET.Windowing.Common\Silk.NET.Windowing.Common.csproj" />
    </ItemGroup>
    
    <!-- iOS Specific Files -->
    <ItemGroup Condition="'$(TargetFramework)' == 'net6.0-ios' Or '$(TargetFramework)' == 'net6.0-maccatalyst'">
        <Compile Include="..\iOS\Silk.NET.Windowing.Sdl.iOS\SilkMobile.cs" Link="iOS/SilkMobile.cs" />
    </ItemGroup>

    <!-- Android Specific Files -->
    <ItemGroup Condition="'$(TargetFramework)' == 'net6.0-android'">
        <TransformFile Include="..\Android\Silk.NET.Windowing.Sdl.Android\Transforms\Metadata.xml" Link="Android/Metadata.xml" />
        <TransformFile Include="..\Android\Silk.NET.Windowing.Sdl.Android\Transforms\EnumFields.xml" Link="Android/EnumFields.xml" />
        <TransformFile Include="..\Android\Silk.NET.Windowing.Sdl.Android\Transforms\EnumMethods.xml" Link="Android/EnumMethods.xml" />
        <Compile Include="..\Android\Silk.NET.Windowing.Sdl.Android\Additions\SilkActivity.cs" />
        <AndroidLibrary Include="..\Android\Silk.NET.Windowing.Sdl.Android\Jars\app-release.aar" Link="Android/app-release.aar" Bind="true" />
    </ItemGroup>
    
    <!-- Closest things to documentation on what the hell this voodoo does:
         https://github.com/NuGet/Home/issues/10063#issuecomment-713083004
         https://github.com/xamarin/xamarin-android/pull/5242
         https://github.com/dotnet/sdk/issues/14042 
         https://github.com/dotnet/sdk/blob/main/src/Tasks/Microsoft.NET.Build.Tasks/targets/Microsoft.NET.PackTool.targets#L54 -->
    
    <PropertyGroup>
        <TargetsForTfmSpecificContentInPackage>$(TargetsForTfmSpecificContentInPackage);_SdlTfmSpecific</TargetsForTfmSpecificContentInPackage>
    </PropertyGroup>

    <Target Name="_SdlTfmSpecific">
        <GetNuGetShortFolderName TargetFrameworkMoniker="$(TargetFrameworkMoniker)" TargetPlatformMoniker="$(TargetPlatformMoniker)">
            <Output TaskParameter="NuGetShortFolderName" PropertyName="_NuGetShortFolderName" />
        </GetNuGetShortFolderName>
        <!-- iOS Specific Bundled Files -->
        <ItemGroup Condition="'$(TargetFramework)' == 'net6.0-ios' Or '$(TargetFramework)' == 'net6.0-maccatalyst'">
            <TfmSpecificPackageFile Include="..\iOS\Silk.NET.Windowing.Sdl.iOS\libSDL2.a" Pack="true" Link="build/$(_NuGetShortFolderName)/libSDL2.a" PackagePath="build/$(_NuGetShortFolderName)/native/libSDL2.a" CopyToOutputDirectory="PreserveNewest" />
            <TfmSpecificPackageFile Include="..\iOS\Silk.NET.Windowing.Sdl.iOS\Silk.NET.Windowing.Sdl.iOS.targets" Link="build/$(_NuGetShortFolderName)/Silk.NET.Windowing.Sdl.targets" Pack="true" PackagePath="build/$(_NuGetShortFolderName)/Silk.NET.Windowing.Sdl.targets" />
        </ItemGroup>
        <!-- Android Specific Bundled Files -->
        <ItemGroup Condition="'$(TargetFramework)' == 'net6.0-android'">
            <!-- https://github.com/xamarin/xamarin-android/issues/5957 
                 https://github.com/xamarin/xamarin-android/blob/main/Documentation/guides/OneDotNetEmbeddedResources.md -->
            <TfmSpecificPackageFile Include="..\Android\Silk.NET.Windowing.Sdl.Android\Jars\app-release.aar" Link="lib/$(_NuGetShortFolderName)/Silk.NET.Windowing.Sdl.aar" Pack="true" PackagePath="lib/$(_NuGetShortFolderName)/Silk.NET.Windowing.Sdl.aar" />
        </ItemGroup>
    </Target>

    <Import Project="..\..\..\build\props\common.props" />

</Project>
